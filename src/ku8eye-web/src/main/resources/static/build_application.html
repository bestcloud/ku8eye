<div style="padding: 10px 50px">
	<form class="form-horizontal" role="form">
		<div class="form-group">
			<div class="col-sm-10">
				<h3>
					<span class="label label-default">&nbsp;&nbsp;&nbsp;Application
						&nbsp;&nbsp;&nbsp;</span>
				</h3>
			</div>
		</div>

		<div class="form-group">
			<label class="col-sm-2 control-label">Application Name</label>
			<div class="col-sm-8">
				<input type="text" class="form-control" id="appName"
					placeholder="项目名称">
			</div>
		</div>

		<div class="form-group">
			<label class="col-sm-2 control-label">Version</label>
			<div class="col-sm-8">
				<input type="text" class="form-control" id="version"
					placeholder="项目版本号">
			</div>
		</div>

		<div class="form-group">
			<label class="col-sm-2 control-label">Author</label>
			<div class="col-sm-8">
				<input type="text" class="form-control" id="author"
					placeholder="所有人">
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label">K8s Version</label>
			<div class="col-sm-8">
				<input type="text" class="form-control" id="kuberneteVersion"
					placeholder="kubernete版本">
			</div>
		</div>

		<div class="form-group">
			<label class="col-sm-2 control-label">Notes</label>
			<div class="col-sm-8">
				<input type="text" class="form-control" id="note"
					placeholder="笔记">
			</div>
		</div>
		<!-- service -->

		<div class="form-group panel-group" name="service">
			<div class="panel panel-info">
				<div class="panel-heading">
					Service
					<button type="button" class="btn btn-primary" onclick="add()">+</button>
					<button type="button" class="btn btn-primary" onclick="del(this)">-</button>
					<button type="button" class="btn btn-primary"
						data-parent="#selector" data-toggle="collapse"
						data-target="#service_panel_0" onclick="hide_show(this)">></button>
				</div>
				<div class="panel-body" id="service_panel_0"></div>
			</div>
		</div>

	</form>

	<div class="modal-footer">
		<button onclick="return createApplication()" type="button" class="btn btn-primary">
			保<span style="padding-left: 12px" />存
		</button>
		<button type="button" class="btn btn-default" data-dismiss="modal"
			onclick="back()">
			返<span style="padding-left: 12px" />回
		</button>

	</div>

</div>

<script src="../js/project.js"></script>
<script>
	var _id = sessionStorage.getItem("appID");
	
	$(document).ready(function(){
		sessionStorage.removeItem("appID");
		if(_id !== null)
		{
			$.ajax({
				url: "/getApplication",
				type: "GET",
				dataType: "json",
				data: {id:_id},
				success: function(data){
					console.log(data);
					$("#appName").val(data['name']);
					$("#version").val(data['version']);
					$("#author").val(data['owner']);
					$("#kuberneteVersion").val(data['k8sVersion']);
					$("#note").val(data['note']);
				}
			});
		}
		else
		{
			alert("no session found, error");
		}
	});
	
	function checkInput(){
		return true;
	}
	
	function createApplication()
	{
		if(checkInput())
		{
			var _jsonStr = $proObj;
			console.log(_jsonStr);
			$.ajax({
				url: "/createApplication",
				type: "POST",
				dataType: "json",
				data: {
					id:_id,
					jsonStr:JSON.stringify(_jsonStr)
				},
				success: function(response){
					console.log(response);
					if(response['status'] > -1)
					{
						back();
						var _appName = $("#appName").val()
						var _div = $('<div>');
						_div.load('alert.html', function(){
							$(this).find('#title').html(response['message']);
							$(this).find('#message').html("Project <strong>" + _appName + "</strong> updated successfully.");
							var child = $(this).children();
							child.fadeTo(3000, 500).slideToggle(500, function(){
								child.alert('close');
							});
							$('.content').append(child);
						});
					}
					else
					{
						alert("failed");
					}
				}
			});
		}
	}
	
	function loadData() {
		$("#service_panel_0").load("./service_project.html?d1=112");
		$('#service_panel_0').toggle(1000);
	}

	function hide_show(obj) {
		$ob = $(obj);
		$($ob.attr("data-target")).toggle(1000);
	}
	function back() {
		$('.content').load('application_main.html');
	}

	function add() {
		var $services = $(".form-group[name='service']");
		if ($services.length > 0) {
			var $service = $services.eq(0);
			var $new_service = $service.clone();
			var id = $services.length + 1;
			$new_service.children("div").children(".panel-heading").children(
					"button").attr("data-target", "#service_panel_" + id);
			$new_service.children("div").children(".panel-body").attr("id",
					"service_panel_" + id);
			$service.after($new_service);
		}

	}

	function del(obj) {
		var $services = $(".form-group[name='service']");
		
		if ($services.length > 1) {
			$(obj).parent().parent().parent().remove();
		}
	}
</script>